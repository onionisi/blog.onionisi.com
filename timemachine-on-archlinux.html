<!DOCTYPE html>
<html lang="en">
<head>

    <meta charset="utf-8">

    <meta name="tags" content="OSXlinuxtimemachine">

    <meta name="category" content="Blog">

    <meta name="date" content="2014-05-08 00:00:00">

    <meta name="author" content="Chong Yang">

    <title>onionisi | TimeMachine on Archlinux</title>

        <link rel="stylesheet" href="./theme/css/style.min.css?981d7269">

    <link rel="shortcut icon" href="./theme/img/favicon.ico" />
    <link rel="icon" sizes="16x16 32x32" href="./theme/img/favicon.ico">



</head>

<body>
    <header id="sitehead">
        <div class="sitehead">
            <span id="sitehead">
                <a href=".">onionisi</a>
            </span>
        </div>
            <div id="tagline">
                <strong>fprintf(post, "%s\n", daily_life)</strong>
            </div>
        <nav class="navbar">
                <a href="./category/blog.html">Blog</a>&nbsp;
                    <a href="./pages/about.html">About</a>&nbsp;
        </nav>
    </header><!-- /header-siteheader -->
<section id="content">
    <article>
        <header>
            <h1 class="entry-title">
                <a href="" id="entry-title-link" rel="bookmark" title="Permalink to TimeMachine on Archlinux">TimeMachine on Archlinux</a>
            </h1>
        </header>


        <div class="entry-content">
            <h2>前因</h2>
<p>之前拿到新电脑很是兴奋，捯饬很比较猛，主要还是想目的就是延长SSD使用寿命，于是乎找了各种措施来减少SSD的写入。万恶的是没有任何备份，当我满心欢喜的禁用了磁盘的日志功能时，心想怎么可能意外断电捏。哪里知道就在第二天浏览淘宝时，打开网页太多导致浏览器卡死了系统，任何操作都不灵了。妈蛋滴，果断强制关机，reboot，老有一个进度条过不来，打客服电话，最后把我弄到检查磁盘的时候，发现磁盘损坏根本修复不了。这时才焕然大悟想起自己关闭了日志，天要亡我，奈何啊，可怜我的资料啊。</p>
<p>格式化磁盘的时候那叫个恋恋不舍啊，只能忍痛了，在线安装好Marvicks后，看着才出的Yosemite心痒痒，干脆一横心直接升了，这一来二回把我之前节约的写入全糟践了。心里便想着还是要搞个备份才行，Mac不是Linux，什么东西你都能Control，还是小心谨慎为好。</p>
<h2>后果</h2>
<p>恋恋不忘，必有回响，总算打起精神准备，把重装新系统以来各种资料备份一下，再丢了就只能掩面而泣了。linux世界的geek们不会让我们失望滴，netatalk就是来抢time capsule生意滴。</p>
<p>配置文件位置 /etc/afp.conf</p>
<div class="highlight"><pre><span class="k">[Global]</span>
<span class="na">mimic model</span> <span class="o">=</span> <span class="s">TimeCapsule6,106</span>
<span class="na">log level</span> <span class="o">=</span> <span class="s">default:warn</span>
<span class="na">log file</span> <span class="o">=</span> <span class="s">/var/log/afpd.log</span>
<span class="na">hosts allow</span> <span class="o">=</span> <span class="s">192.168.1.0/16</span>

<span class="k">[TimeMachine]</span>
<span class="na">path</span> <span class="o">=</span> <span class="s">/path/of/TimeMachine</span>
<span class="na">time machine</span> <span class="o">=</span> <span class="s">yes</span>
</pre></div>


<p>然后systemd使能并启动netatalk和avahi，进入Time Machine设置搞定啦。</p>
<h2>one more thing</h2>
<p>以前我挂载其他电脑文件夹习惯性使用sshfs，Mac需要FUSE OSX依赖安装麻烦，但是netatalk还可以使用共享。
配置文件中加入如下</p>
<div class="highlight"><pre><span class="k">[Media]</span>
<span class="na">path</span> <span class="o">=</span> <span class="s">/path/of/media/</span>
</pre></div>


<p>其他linux也可以把afpfs当NFS挂载</p>
<div class="highlight"><pre><span class="n">mount_afp</span> <span class="err">&#39;</span><span class="n">afp</span><span class="o">:</span><span class="c1">//username:password@ipaddr/Media&#39; /mount/path/</span>
</pre></div>


<p>再也不用担心NFS挂载的麻烦啦。</p>
<footer class="post-info">
    <abbr class="published" title="2014-05-08T00:00:00">
        Posted on 四 08 五月 2014 by Chong Yang |     tags: <a href="./tag/osx.html">OSX</a> <a href="./tag/linux.html">linux</a> <a href="./tag/timemachine.html">timemachine</a>     </abbr>
</footer><!-- /footer-post-info -->
        </div><!-- /.entry-content -->
<script src="https://apis.google.com/js/plusone.js"></script>
<div id="comments"></div>
<script>
    gapi.comments.render('comments', {
        href: window.location,
        width: '635',
        first_party_property: 'BLOGGER',
        view_type: 'FILTERED_POSTMOD'
    });
</script>
    </article>
</section>
    <section id="extras">
    </section><!-- /sectin-extras -->

    <footer id="footer">
        <address id="about" class="vcard">
            &copy; 2014 <a class="url fn" href=".">onionisi</a>
        </address><!-- /address-about -->
    </footer><!-- /footer-footer -->


</body>
</html>
